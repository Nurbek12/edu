import{r as m,a as s,o as p,c as V,w as e,b as t,f as c,d as n,t as d,i as q,F as U,k as me,j as N,h as k,u as pe,l as _e,m as ve,e as fe,n as he}from"./index-2e243627.js";const ye={class:"responsive-datatable"},be={"data-label":"Ism familiyasi"},we={"data-label":"Yuborilgan vaqti"},ke={"data-label":"Baho"},ge=["colspan"],xe={class:"text-body-2"},Ve=n("br",null,null,-1),$e={class:"text-body-2"},ze=["href"],je={"data-label":"Guruhi"},qe=n("div",null,"Hech narsa topilmadi",-1),Ce={__name:"HomeWorkTable",props:{homeworkid:{type:String}},setup(Q){const S=Q,$=[{title:"Talaba",key:"name",align:"start",sortable:!1},{title:"Guruhi",key:"group",sortable:!1},{title:"Yuborilgan vaqti",key:"date"},{title:"Baho",key:"rate"}],I=m([]),C=m([]),F=m(""),y=async()=>{const{data:b}=await k.get(`/homework/id/${S.homeworkid}`);b&&(I.value=b.studentHomeworks||[])},O=async(b,_,g)=>{if(confirm(`Siz talaba ${_.student}ga ${b} baho qo'yyapsiz!`)){let r;do r=prompt("Bahoga qo'yilgan izohni yozing");while(!r.trim());const w={rate:b,rate_description:r};Object.assign(I.value[g],w),await k.put(`/homework/edit/${_._id}?student=true`,w)}};return y(),(b,_)=>{const g=s("v-spacer"),r=s("v-icon"),w=s("v-btn"),G=s("v-card-title"),i=s("v-select"),T=s("v-chip"),H=s("v-divider"),Y=s("v-list-item-title"),D=s("v-list-item"),M=s("v-list"),E=s("v-data-table"),R=s("v-card-text"),W=s("v-card");return p(),V(W,null,{default:e(()=>[t(G,{class:"text-h6 d-flex justify-space-between align-center"},{default:e(()=>[c(" Yuborilgan topshiriqlar "),t(g),t(w,{size:"30",color:"primary",onClick:_[0]||(_[0]=u=>b.$emit("closeView"))},{default:e(()=>[t(r,{size:"small"},{default:e(()=>[c("mdi-close")]),_:1})]),_:1})]),_:1}),t(R,{class:"px-2"},{default:e(()=>[n("div",ye,[t(E,{density:"compact","items-per-page-text":"","items-per-page":"-1",headers:$,search:F.value,items:I.value,"item-value":"_id","show-expand":"",expanded:C.value,"onUpdate:expanded":_[1]||(_[1]=u=>C.value=u)},{"item.name":e(({index:u,item:f})=>[n("td",be,d(u+1)+". "+d(f.raw.student),1)]),"item.date":e(({item:u})=>[n("td",we,d(u.raw.date),1)]),"item.rate":e(({index:u,item:f})=>[n("td",ke,[f.raw.rate?(p(),V(T,{key:1,label:"",color:"primary"},{default:e(()=>[c(d(f.raw.rate),1)]),_:2},1024)):(p(),V(i,{key:0,items:[0,1,2,3,4,5],"onUpdate:modelValue":z=>O(z,f.raw,u),"hide-details":"",density:"compact",flat:"",color:"primary",variant:"outlined"},null,8,["onUpdate:modelValue"]))])]),"expanded-row":e(({columns:u,item:f})=>[n("tr",null,[n("td",{colspan:u.length},[n("span",xe,"Vazifa izohi: "+d(f.raw.description),1),c(),Ve,f.raw.rate_description?(p(),q(U,{key:0},[t(H),n("span",$e,"Baho izohi: "+d(f.raw.rate_description),1)],64)):me("",!0),t(H),t(M,{density:"compact"},{default:e(()=>[(p(!0),q(U,null,N(f.raw.files,(z,L)=>(p(),V(D,{key:z,class:"px-0"},{append:e(()=>[n("a",{href:`/files/${z}`,target:"_blank",download:"true"},[t(w,{color:"primary",size:"30",variant:"flat",class:"ml-3"},{default:e(()=>[t(r,null,{default:e(()=>[c("mdi-download")]),_:1})]),_:1})],8,ze)]),default:e(()=>[t(Y,{class:"text-body-2"},{default:e(()=>[c(d(L+1)+". "+d(z),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)],8,ge)])]),"item.group":e(({item:u})=>[n("td",je,d(u.raw.group),1)]),"no-data":e(()=>[qe]),_:1},8,["search","items","expanded"])])]),_:1})]),_:1})}}},Ue={class:"responsive-datatable"},Ie={"data-label":"Topshiriq nomi"},Fe={"data-label":"Fan nomi"},Te={"data-label":"Guruhlar"},Be={style:{display:"flex",gap:"5px"}},Oe={"data-label":"Muxlati"},Ge={"data-label":"Izohi"},He={"data-label":"Boshqarish"},Ne={class:"d-flex justify-end"},Se={class:"text-h5"},Ye=n("thead",null,[n("tr",null,[n("th",{class:"text-left"},"Fayl Nomi"),n("th",{class:"text-left"})])],-1),De={class:"text-caption gray"},Me=["href"],Re={__name:"HomeWorks",setup(Q){const S=[{title:"Topshiriq nomi",key:"name"},{title:"Fani",key:"subject",sortable:!1},{title:"Guruhlar",key:"group",sortable:!1},{title:"Muhlati",key:"date"},{title:"Izohi",key:"description",sortable:!1},{title:"Boshqarish",key:"actions",sortable:!1}],$=[l=>!!l||"Required"],I=pe(),C=m(""),F=m(null),y=m([]),O=m([]),b=m([]),_=m(!1),g=m(!1),r=m(-1),w=m(-1),G=m(null),i=m({groups:[],teacher:"",name:"",description:"",subject:null,date:""}),T=m([]),H={groups:[],teacher:"",name:"",description:"",subject:null,date:""},Y=_e(()=>r.value===-1?"Topshiriq Yaratish":"Topshiriqni O'zgartirish");ve(_,l=>l||u());const D=async()=>{const l=await Promise.all([k.get("/subject/access"),k.get("/group/access"),k.get("/homework")]);O.value=l[0].data,b.value=l[1].data,y.value=l[2].data},M=async()=>{const{valid:l}=await F.value.validate();l&&f()},E=l=>{r.value=y.value.indexOf(l),w.value=l._id,i.value=Object.assign({},l),_.value=!0},R=l=>{r.value=y.value.indexOf(l),i.value=Object.assign({},l),w.value=l._id,confirm("Ushbu malumotni o'chirmoqchimisiz?")?W():u()},W=async()=>{const{data:l}=await k.delete(`/homework/${w.value}`);l&&(y.value.splice(r.value,1),u())},u=()=>{_.value=!1,he(()=>{var l;i.value=Object.assign({},H),w.value=-1,r.value=-1,(l=F.value)==null||l.reset()})},f=async()=>{const l=new FormData;if(l.append("name",i.value.name),l.append("subject",i.value.subject),l.append("description",i.value.description),l.append("date",i.value.date),l.append("teacher",I.getters.userid),T.value.map(o=>l.append("files",o)),i.value.groups.map(o=>l.append("groups",o)),r.value>-1){const{data:o}=await k.put(`/homework/edit/${w.value}`,i.value);Object.assign(y.value[r.value],o)}else{const{data:o}=await k.post("/homework",l);y.value.push(o)}u()},z=async l=>{const o=new FormData;o.append("file",l.target.files[0]);const{data:j}=await k.put(`/homework/addfile/${i.value._id}`,o);y.value[r.value].files.push(j)},L=async(l,o)=>{confirm("Ushbu malumotni o'chirmoqchimisiz?")&&(await k.put(`/resource/rmfile/${i.value._id}/${l}`),y.value[r.value].files.splice(o,1))},te=()=>document.getElementById("file-input").click(),ae=l=>l.map(o=>b.value.find(({_id:j})=>j===o).name);return D(),(l,o)=>{const j=s("v-text-field"),v=s("v-col"),x=s("v-btn"),P=s("v-row"),A=s("v-sheet"),J=s("v-chip"),le=s("v-spacer"),B=s("v-icon"),oe=s("v-data-table"),se=s("v-card-title"),K=s("v-select"),ne=s("v-file-input"),ie=s("v-table"),de=s("v-textarea"),re=s("v-form"),X=s("v-container"),ue=s("v-card-text"),ce=s("v-card"),Z=s("v-dialog");return p(),V(X,{fluid:""},{default:e(()=>[t(P,null,{default:e(()=>[t(v,{cols:"12"},{default:e(()=>[t(A,{elevation:"1",color:"surface",width:"100%",class:"pa-2 py-4",rounded:""},{default:e(()=>[t(P,{justify:"space-between",align:"center"},{default:e(()=>[t(v,{class:"py-1",cols:"12",sm:"4"},{default:e(()=>[t(j,{label:"Qidirish",modelValue:C.value,"onUpdate:modelValue":o[0]||(o[0]=a=>C.value=a),variant:"outlined",color:"primary",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),t(v,{class:"py-1",cols:"12",sm:"4",md:"3"},{default:e(()=>[t(x,{block:"",height:"42",color:"primary",onClick:o[1]||(o[1]=a=>_.value=!0),variant:"flat"},{default:e(()=>[c("Topshiriq yaratish")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(v,{cols:"12"},{default:e(()=>[t(A,{elevation:"1",color:"surface",width:"100%",class:"pa-2",rounded:""},{default:e(()=>[n("div",Ue,[t(oe,{"no-data-text":"Hech narsa topilmadi","items-per-page-text":"",headers:S,search:C.value,items:y.value},{"item.name":e(({index:a,item:h})=>[n("td",Ie,d(a+1)+". "+d(h.raw.name),1)]),"item.subject":e(({item:a})=>[n("td",Fe,d(a.raw.subject),1)]),"item.group":e(({item:a})=>[n("td",Te,[n("div",Be,[(p(!0),q(U,null,N(ae(a.raw.groups),(h,ee)=>(p(),V(J,{label:"",color:"primary",size:"small",key:ee},{default:e(()=>[c(d(h),1)]),_:2},1024))),128))])])]),"item.date":e(({item:a})=>[n("td",Oe,d(a.raw.date),1)]),"item.description":e(({item:a})=>[n("td",Ge,d(a.raw.description),1)]),"item.actions":e(({item:a})=>[n("td",He,[t(le),n("div",Ne,[t(x,{variant:"flat",class:"ml-1",size:"30",color:"primary",onClick:h=>E(a.raw)},{default:e(()=>[t(B,null,{default:e(()=>[c("mdi-pencil")]),_:1})]),_:2},1032,["onClick"]),t(x,{variant:"flat",class:"ml-1",size:"30",color:"primary",onClick:h=>R(a.raw)},{default:e(()=>[t(B,null,{default:e(()=>[c("mdi-delete")]),_:1})]),_:2},1032,["onClick"]),t(x,{variant:"flat",class:"ml-1",size:"30",color:"primary",onClick:h=>(g.value=!0,G.value=a.raw._id)},{default:e(()=>[t(B,null,{default:e(()=>[c("mdi-briefcase-eye")]),_:1})]),_:2},1032,["onClick"])])])]),_:1},8,["search","items"])])]),_:1})]),_:1})]),_:1}),t(Z,{modelValue:_.value,"onUpdate:modelValue":o[8]||(o[8]=a=>_.value=a),"max-width":"550px"},{default:e(()=>[t(ce,null,{default:e(()=>[t(se,{class:"mt-2 ml-2 mb-0"},{default:e(()=>[n("span",Se,d(fe(Y)),1)]),_:1}),t(ue,{class:"px-2 pt-0"},{default:e(()=>[t(X,null,{default:e(()=>[t(re,{ref_key:"form",ref:F},{default:e(()=>[t(P,null,{default:e(()=>[t(v,{cols:"12"},{default:e(()=>[t(j,{modelValue:i.value.name,"onUpdate:modelValue":o[2]||(o[2]=a=>i.value.name=a),label:"Topshiriq nomi","hide-details":"",color:"primary",rules:$,variant:"outlined"},null,8,["modelValue"])]),_:1}),t(v,{cols:"12"},{default:e(()=>[t(K,{modelValue:i.value.groups,"onUpdate:modelValue":o[3]||(o[3]=a=>i.value.groups=a),label:"Guruhlar",rules:$,"hide-details":"",multiple:"",items:b.value,color:"primary","item-title":"name","item-value":"_id",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),t(v,{cols:"12",sm:"6"},{default:e(()=>[t(K,{modelValue:i.value.subject,"onUpdate:modelValue":o[4]||(o[4]=a=>i.value.subject=a),label:"Fan nomi",rules:$,"hide-details":"",items:O.value,color:"primary","item-title":"name","item-value":"name",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),t(v,{cols:"12",sm:"6"},{default:e(()=>[t(j,{type:"date",modelValue:i.value.date,"onUpdate:modelValue":o[5]||(o[5]=a=>i.value.date=a),label:"Muhlati","hide-details":"",color:"primary",rules:$,variant:"outlined"},null,8,["modelValue"])]),_:1}),r.value===-1?(p(),V(v,{key:0,cols:"12"},{default:e(()=>[t(ne,{"hide-details":"",variant:"outlined",color:"primary",modelValue:T.value,"onUpdate:modelValue":o[6]||(o[6]=a=>T.value=a),"prepend-icon":null,label:"Fayllar",multiple:"","show-size":!0},{selection:e(({fileNames:a})=>[(p(!0),q(U,null,N(a,h=>(p(),V(J,{key:h,size:"small",label:"",color:"primary",class:"me-2"},{default:e(()=>[c(d(h),1)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})):(p(),q(U,{key:1},[t(v,{cols:"12",class:"px-0 py-0"},{default:e(()=>[t(ie,{density:"compact"},{default:e(()=>[Ye,n("tbody",null,[(p(!0),q(U,null,N(i.value.files,(a,h)=>(p(),q("tr",{key:a},[n("td",null,[n("span",De,d(h+1)+". "+d(a),1)]),n("td",null,[n("a",{href:`/files/${a}`,download:"",target:"_blank"},[t(x,{color:"primary",variant:"flat",size:"25",class:"mr-1"},{default:e(()=>[t(B,{size:"small"},{default:e(()=>[c("mdi-download")]),_:1})]),_:1})],8,Me),t(x,{color:"primary",variant:"flat",size:"25",onClick:ee=>L(a,h)},{default:e(()=>[t(B,{size:"small"},{default:e(()=>[c("mdi-delete")]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1})]),_:1}),t(v,{cols:"12"},{default:e(()=>[n("input",{type:"file",hidden:"",id:"file-input",onChange:z},null,32),t(x,{variant:"flat",onClick:te,color:"primary",block:"",height:"45"},{default:e(()=>[c(" Fayl qo'shish ")]),_:1})]),_:1})],64)),t(v,{cols:"12"},{default:e(()=>[t(de,{modelValue:i.value.description,"onUpdate:modelValue":o[7]||(o[7]=a=>i.value.description=a),label:"Topshiriq izohi","hide-details":"",color:"primary",rules:$,variant:"outlined"},null,8,["modelValue"])]),_:1}),t(v,{cols:"12",class:"pt-0"},{default:e(()=>[t(x,{variant:"flat",color:"primary",block:"",onClick:M,height:"45"},{default:e(()=>[c(" Saqlash ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Z,{modelValue:g.value,"onUpdate:modelValue":o[10]||(o[10]=a=>g.value=a),persistent:""},{default:e(()=>[t(Ce,{onCloseView:o[9]||(o[9]=a=>g.value=!1),homeworkid:G.value},null,8,["homeworkid"])]),_:1},8,["modelValue"])]),_:1})}}};export{Re as default};
