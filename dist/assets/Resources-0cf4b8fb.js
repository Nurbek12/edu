import{u as ne,r as m,l as ie,n as ue,a as i,o as h,c as $,w as e,b as a,f as _,d as s,t as r,e as de,h as x,i as R,F as q,p as re}from"./index-28b05177.js";import{a as p}from"./index-7376b9a9.js";const ce={class:"responsive-datatable"},me={"data-label":"T/r"},ve={"data-label":"Resurs nomi"},_e={"data-label":"Fan nomi"},pe={"data-label":"Guruh"},fe={"data-label":"O'qituvchi"},he={"data-label":"Sanasi"},ye={"data-label":"Auditoriya"},be={"data-label":"Boshqarish"},ge={class:"d-flex justify-end"},ke=s("div",null,"Hech narsa topilmadi",-1),we={class:"text-h5"},Ve=s("thead",null,[s("tr",null,[s("th",{class:"text-left"},"Fan Nomi"),s("th",{class:"text-left"})])],-1),xe={class:"text-caption gray"},je=["href"],qe={__name:"Resources",setup(ze){const S=[{title:"T/r",align:"start",key:"no",sortable:!1},{title:"Resurs nomi",key:"name"},{title:"Fan nomi",key:"subject"},{title:"Guruhi",key:"group"},{title:"O'qituvchi",key:"teacher"},{title:"Auditoriya",key:"room"},{title:"Boshqarish",key:"actions",sortable:!1}],k=[l=>!!l||"Required"],I=ne(),j=m(""),z=m(null),v=m([]),O=m([]),U=m([]),y=m(!1),c=m(-1),b=m(-1),n=m({name:null,group:null,subject:null,room:""}),C=m([]),A={name:null,group:null,subject:null,room:""},D=ie(()=>c.value===-1?"Ma'ruza Yaratish":"Ma'ruza O'zgartirish");ue(y,l=>l||w());const G=async()=>{const l=await Promise.all([p.get("/subject/access"),p.get("/group/access"),p.get(`/resource?teacher=${I.getters.userid}`)]);O.value=l[0].data,U.value=l[1].data,v.value=l[2].data},N=async()=>{const{valid:l}=await z.value.validate();l&&P()},E=l=>{c.value=v.value.indexOf(l),b.value=l._id,n.value=Object.assign({},l),y.value=!0},H=l=>{c.value=v.value.indexOf(l),n.value=Object.assign({},l),b.value=l._id,confirm("Ushbu malumotni o'chirmoqchimisiz?")?L():w()},L=async()=>{const{data:l}=await p.delete(`/resource/${b.value}`);l&&(v.value.splice(c.value,1),w())},w=()=>{y.value=!1,re(()=>{var l;n.value=Object.assign({},A),b.value=-1,c.value=-1,(l=z.value)==null||l.reset()})},P=async()=>{const l=new FormData;if(l.append("name",n.value.name),l.append("group",n.value.group),l.append("subject",n.value.subject),l.append("room",n.value.room),l.append("date",n.value.date),l.append("teacher",I.getters.userid),C.value.map(o=>l.append("files",o)),c.value>-1){const{data:o}=await p.put(`/resource/${b.value}`,n.value);Object.assign(v.value[c.value],o)}else{const{data:o}=await p.post("/resource",l);v.value.push(o)}w()},Q=async l=>{const o=new FormData;o.append("file",l.target.files[0]);const{data:g}=await p.put(`/resource/addfile/${n.value._id}`,o);v.value[c.value].files.push(g)},Y=async(l,o)=>{confirm("Ushbu malumotni o'chirmoqchimisiz?")&&(await p.put(`/resource/rmfile/${n.value._id}/${l}`),v.value[c.value].files.splice(o,1))},J=()=>document.getElementById("file-input").click();return G(),(l,o)=>{const g=i("v-text-field"),d=i("v-col"),f=i("v-btn"),F=i("v-row"),B=i("v-sheet"),K=i("v-spacer"),V=i("v-icon"),W=i("v-data-table"),X=i("v-card-title"),T=i("v-select"),Z=i("v-chip"),ee=i("v-file-input"),ae=i("v-table"),te=i("v-form"),M=i("v-container"),le=i("v-card-text"),oe=i("v-card"),se=i("v-dialog");return h(),$(M,{fluid:""},{default:e(()=>[a(F,null,{default:e(()=>[a(d,{cols:"12"},{default:e(()=>[a(B,{elevation:"1",color:"surface",width:"100%",class:"pa-2 py-4",rounded:""},{default:e(()=>[a(F,{justify:"space-between",align:"center"},{default:e(()=>[a(d,{class:"py-1",cols:"12",sm:"4"},{default:e(()=>[a(g,{label:"Qidirish",modelValue:j.value,"onUpdate:modelValue":o[0]||(o[0]=t=>j.value=t),variant:"outlined",color:"primary",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),a(d,{class:"py-1",cols:"12",sm:"4",md:"3"},{default:e(()=>[a(f,{block:"",height:"42",color:"primary",onClick:o[1]||(o[1]=t=>y.value=!0),variant:"flat"},{default:e(()=>[_("Ma'ruza yaratish")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(d,{cols:"12"},{default:e(()=>[a(B,{elevation:"1",color:"surface",width:"100%",class:"pa-2",rounded:""},{default:e(()=>[s("div",ce,[a(W,{"items-per-page-text":"",headers:S,search:j.value,items:v.value},{"item.no":e(({index:t})=>[s("td",me,r(t+1)+".",1)]),"item.name":e(({item:t})=>[s("td",ve,r(t.raw.name),1)]),"item.subject":e(({item:t})=>[s("td",_e,r(t.raw.subject),1)]),"item.group":e(({item:t})=>{var u;return[s("td",pe,r((u=t.raw.group)==null?void 0:u.name),1)]}),"item.teacher":e(({item:t})=>{var u;return[s("td",fe,r((u=t.raw.teacher)==null?void 0:u.name),1)]}),"item.date":e(({item:t})=>[s("td",he,r(t.raw.date),1)]),"item.room":e(({item:t})=>[s("td",ye,r(t.raw.room),1)]),"item.actions":e(({item:t})=>[s("td",be,[a(K),s("div",ge,[a(f,{variant:"flat",class:"ml-1",size:"30",color:"primary",onClick:u=>E(t.raw)},{default:e(()=>[a(V,null,{default:e(()=>[_("mdi-pencil")]),_:1})]),_:2},1032,["onClick"]),a(f,{variant:"flat",class:"ml-1",size:"30",color:"primary",onClick:u=>H(t.raw)},{default:e(()=>[a(V,null,{default:e(()=>[_("mdi-delete")]),_:1})]),_:2},1032,["onClick"])])])]),"no-data":e(()=>[ke]),_:1},8,["search","items"])])]),_:1})]),_:1})]),_:1}),a(se,{modelValue:y.value,"onUpdate:modelValue":o[7]||(o[7]=t=>y.value=t),"max-width":"550px"},{default:e(()=>[a(oe,null,{default:e(()=>[a(X,{class:"mt-2 ml-2 mb-0"},{default:e(()=>[s("span",we,r(de(D)),1)]),_:1}),a(le,{class:"px-2 pt-0"},{default:e(()=>[a(M,null,{default:e(()=>[a(te,{ref_key:"form",ref:z},{default:e(()=>[a(F,null,{default:e(()=>[a(d,{cols:"12"},{default:e(()=>[a(g,{modelValue:n.value.name,"onUpdate:modelValue":o[2]||(o[2]=t=>n.value.name=t),label:"Ma'ruza mavzusi","hide-details":"",color:"primary",rules:k,variant:"outlined"},null,8,["modelValue"])]),_:1}),a(d,{cols:"12"},{default:e(()=>[a(T,{modelValue:n.value.group,"onUpdate:modelValue":o[3]||(o[3]=t=>n.value.group=t),label:"Guruh",rules:k,"hide-details":"",items:U.value,color:"primary","item-title":"name","item-value":"_id",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),a(d,{cols:"12"},{default:e(()=>[a(T,{modelValue:n.value.subject,"onUpdate:modelValue":o[4]||(o[4]=t=>n.value.subject=t),label:"Fan nomi",rules:k,"hide-details":"",items:O.value,color:"primary","item-title":"name","item-value":"name",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),a(d,{cols:"12"},{default:e(()=>[a(g,{modelValue:n.value.room,"onUpdate:modelValue":o[5]||(o[5]=t=>n.value.room=t),label:"Auditoriya","hide-details":"",color:"primary",rules:k,variant:"outlined"},null,8,["modelValue"])]),_:1}),c.value===-1?(h(),$(d,{key:0,cols:"12"},{default:e(()=>[a(ee,{"hide-details":"",variant:"outlined",color:"primary",modelValue:C.value,"onUpdate:modelValue":o[6]||(o[6]=t=>C.value=t),"prepend-icon":null,label:"Fayllar",multiple:"","show-size":!0},{selection:e(({fileNames:t})=>[(h(!0),x(q,null,R(t,u=>(h(),$(Z,{key:u,size:"small",label:"",color:"primary",class:"me-2"},{default:e(()=>[_(r(u),1)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})):(h(),x(q,{key:1},[a(d,{cols:"12",class:"px-0 py-0"},{default:e(()=>[a(ae,{density:"compact"},{default:e(()=>[Ve,s("tbody",null,[(h(!0),x(q,null,R(n.value.files,(t,u)=>(h(),x("tr",{key:t},[s("td",null,[s("span",xe,r(u+1)+". "+r(t),1)]),s("td",null,[s("a",{href:`/files/${t}`,download:"",target:"_blank"},[a(f,{color:"primary",variant:"flat",size:"25",class:"mr-1"},{default:e(()=>[a(V,{size:"small"},{default:e(()=>[_("mdi-download")]),_:1})]),_:1})],8,je),a(f,{color:"primary",variant:"flat",size:"25",onClick:Ce=>Y(t,u)},{default:e(()=>[a(V,{size:"small"},{default:e(()=>[_("mdi-delete")]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1})]),_:1}),a(d,{cols:"12"},{default:e(()=>[s("input",{type:"file",hidden:"",id:"file-input",onChange:Q},null,32),a(f,{variant:"flat",onClick:J,color:"primary",block:"",height:"45"},{default:e(()=>[_(" Fayl qo'shish ")]),_:1})]),_:1})],64)),a(d,{cols:"12",class:"pt-0"},{default:e(()=>[a(f,{variant:"flat",color:"primary",block:"",onClick:N,height:"45"},{default:e(()=>[_(" Saqlash ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{qe as default};
