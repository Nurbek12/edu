import{u as ne,r as m,l as ie,m as ue,a as i,o as h,c as $,w as e,h as _,b as a,f as p,d as n,t as r,e as de,i as x,j as S,F as q,n as re}from"./index-868e85fe.js";const ce={class:"responsive-datatable"},me={"data-label":"Resurs nomi"},ve={"data-label":"Fan nomi"},_e={"data-label":"Guruh"},pe={"data-label":"O'qituvchi"},fe={"data-label":"Sanasi"},he={"data-label":"Auditoriya"},be={"data-label":"Boshqarish"},ye={class:"d-flex justify-end"},ge={class:"text-h5"},ke=n("thead",null,[n("tr",null,[n("th",{class:"text-left"},"Fayl Nomi"),n("th",{class:"text-left"})])],-1),we={class:"text-caption gray"},Ve=["href"],Ce={__name:"Resources",setup(xe){const A=[{title:"Resurs nomi",key:"name"},{title:"Fan nomi",key:"subject",sortable:!1},{title:"Guruhi",key:"group",sortable:!1},{title:"O'qituvchi",key:"teacher",sortable:!1},{title:"Auditoriya",key:"room",sortable:!1},{title:"Boshqarish",key:"actions",sortable:!1}],k=[t=>!!t||"Required"],I=ne(),j=m(""),z=m(null),v=m([]),O=m([]),U=m([]),b=m(!1),c=m(-1),y=m(-1),s=m({name:null,group:null,subject:null,room:""}),C=m([]),D={name:null,group:null,subject:null,room:""},G=ie(()=>c.value===-1?"Ma'ruza Yaratish":"Ma'ruza O'zgartirish");ue(b,t=>t||w());const N=async()=>{const t=await Promise.all([_.get("/subject/access"),_.get("/group/access"),_.get(`/resource?teacher=${I.getters.userid}`)]);O.value=t[0].data,U.value=t[1].data,v.value=t[2].data},T=async()=>{const{valid:t}=await z.value.validate();t&&P()},E=t=>{c.value=v.value.indexOf(t),y.value=t._id,s.value=Object.assign({},t),b.value=!0},H=t=>{c.value=v.value.indexOf(t),s.value=Object.assign({},t),y.value=t._id,confirm("Ushbu malumotni o'chirmoqchimisiz?")?L():w()},L=async()=>{const{data:t}=await _.delete(`/resource/${y.value}`);t&&(v.value.splice(c.value,1),w())},w=()=>{b.value=!1,re(()=>{var t;s.value=Object.assign({},D),y.value=-1,c.value=-1,(t=z.value)==null||t.reset()})},P=async()=>{const t=new FormData;if(t.append("name",s.value.name),t.append("group",s.value.group),t.append("subject",s.value.subject),t.append("room",s.value.room),t.append("date",s.value.date),t.append("teacher",I.getters.userid),C.value.map(o=>t.append("files",o)),c.value>-1){const{data:o}=await _.put(`/resource/${y.value}`,s.value);Object.assign(v.value[c.value],o)}else{const{data:o}=await _.post("/resource",t);v.value.push(o)}w()},Q=async t=>{const o=new FormData;o.append("file",t.target.files[0]);const{data:g}=await _.put(`/resource/addfile/${s.value._id}`,o);v.value[c.value].files.push(g)},Y=async(t,o)=>{confirm("Ushbu malumotni o'chirmoqchimisiz?")&&(await _.put(`/resource/rmfile/${s.value._id}/${t}`),v.value[c.value].files.splice(o,1))},J=()=>document.getElementById("file-input").click();return N(),(t,o)=>{const g=i("v-text-field"),d=i("v-col"),f=i("v-btn"),F=i("v-row"),B=i("v-sheet"),K=i("v-spacer"),V=i("v-icon"),W=i("v-data-table"),X=i("v-card-title"),M=i("v-select"),Z=i("v-chip"),ee=i("v-file-input"),ae=i("v-table"),te=i("v-form"),R=i("v-container"),le=i("v-card-text"),oe=i("v-card"),se=i("v-dialog");return h(),$(R,{fluid:""},{default:e(()=>[a(F,null,{default:e(()=>[a(d,{cols:"12"},{default:e(()=>[a(B,{elevation:"1",color:"surface",width:"100%",class:"pa-2 py-4",rounded:""},{default:e(()=>[a(F,{justify:"space-between",align:"center"},{default:e(()=>[a(d,{class:"py-1",cols:"12",sm:"4"},{default:e(()=>[a(g,{label:"Qidirish",modelValue:j.value,"onUpdate:modelValue":o[0]||(o[0]=l=>j.value=l),variant:"outlined",color:"primary",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),a(d,{class:"py-1",cols:"12",sm:"4",md:"3"},{default:e(()=>[a(f,{block:"",height:"42",color:"primary",onClick:o[1]||(o[1]=l=>b.value=!0),variant:"flat"},{default:e(()=>[p("Ma'ruza yaratish")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(d,{cols:"12"},{default:e(()=>[a(B,{elevation:"1",color:"surface",width:"100%",class:"pa-2",rounded:""},{default:e(()=>[n("div",ce,[a(W,{"no-data-text":"Hech narsa topilmadi","items-per-page-text":"",headers:A,search:j.value,items:v.value},{"item.name":e(({index:l,item:u})=>[n("td",me,r(l+1)+". "+r(u.raw.name),1)]),"item.subject":e(({item:l})=>[n("td",ve,r(l.raw.subject),1)]),"item.group":e(({item:l})=>{var u;return[n("td",_e,r((u=l.raw.group)==null?void 0:u.name),1)]}),"item.teacher":e(({item:l})=>{var u;return[n("td",pe,r((u=l.raw.teacher)==null?void 0:u.name),1)]}),"item.date":e(({item:l})=>[n("td",fe,r(l.raw.date),1)]),"item.room":e(({item:l})=>[n("td",he,r(l.raw.room),1)]),"item.actions":e(({item:l})=>[n("td",be,[a(K),n("div",ye,[a(f,{variant:"flat",class:"ml-1",size:"30",color:"primary",onClick:u=>E(l.raw)},{default:e(()=>[a(V,null,{default:e(()=>[p("mdi-pencil")]),_:1})]),_:2},1032,["onClick"]),a(f,{variant:"flat",class:"ml-1",size:"30",color:"primary",onClick:u=>H(l.raw)},{default:e(()=>[a(V,null,{default:e(()=>[p("mdi-delete")]),_:1})]),_:2},1032,["onClick"])])])]),_:1},8,["search","items"])])]),_:1})]),_:1})]),_:1}),a(se,{modelValue:b.value,"onUpdate:modelValue":o[7]||(o[7]=l=>b.value=l),"max-width":"550px"},{default:e(()=>[a(oe,null,{default:e(()=>[a(X,{class:"mt-2 ml-2 mb-0"},{default:e(()=>[n("span",ge,r(de(G)),1)]),_:1}),a(le,{class:"px-2 pt-0"},{default:e(()=>[a(R,null,{default:e(()=>[a(te,{ref_key:"form",ref:z},{default:e(()=>[a(F,null,{default:e(()=>[a(d,{cols:"12"},{default:e(()=>[a(g,{modelValue:s.value.name,"onUpdate:modelValue":o[2]||(o[2]=l=>s.value.name=l),label:"Ma'ruza mavzusi","hide-details":"",color:"primary",rules:k,variant:"outlined"},null,8,["modelValue"])]),_:1}),a(d,{cols:"12"},{default:e(()=>[a(M,{modelValue:s.value.group,"onUpdate:modelValue":o[3]||(o[3]=l=>s.value.group=l),label:"Guruh",rules:k,"hide-details":"",items:U.value,color:"primary","item-title":"name","item-value":"_id",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),a(d,{cols:"12"},{default:e(()=>[a(M,{modelValue:s.value.subject,"onUpdate:modelValue":o[4]||(o[4]=l=>s.value.subject=l),label:"Fan nomi",rules:k,"hide-details":"",items:O.value,color:"primary","item-title":"name","item-value":"name",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),a(d,{cols:"12"},{default:e(()=>[a(g,{modelValue:s.value.room,"onUpdate:modelValue":o[5]||(o[5]=l=>s.value.room=l),label:"Auditoriya","hide-details":"",color:"primary",rules:k,variant:"outlined"},null,8,["modelValue"])]),_:1}),c.value===-1?(h(),$(d,{key:0,cols:"12"},{default:e(()=>[a(ee,{"hide-details":"",variant:"outlined",color:"primary",modelValue:C.value,"onUpdate:modelValue":o[6]||(o[6]=l=>C.value=l),"prepend-icon":null,label:"Fayllar",multiple:"","show-size":!0},{selection:e(({fileNames:l})=>[(h(!0),x(q,null,S(l,u=>(h(),$(Z,{key:u,size:"small",label:"",color:"primary",class:"me-2"},{default:e(()=>[p(r(u),1)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})):(h(),x(q,{key:1},[a(d,{cols:"12",class:"px-0 py-0"},{default:e(()=>[a(ae,{density:"compact"},{default:e(()=>[ke,n("tbody",null,[(h(!0),x(q,null,S(s.value.files,(l,u)=>(h(),x("tr",{key:l},[n("td",null,[n("span",we,r(u+1)+". "+r(l),1)]),n("td",null,[n("a",{href:`/files/${l}`,download:"",target:"_blank"},[a(f,{color:"primary",variant:"flat",size:"25",class:"mr-1"},{default:e(()=>[a(V,{size:"small"},{default:e(()=>[p("mdi-download")]),_:1})]),_:1})],8,Ve),a(f,{color:"primary",variant:"flat",size:"25",onClick:je=>Y(l,u)},{default:e(()=>[a(V,{size:"small"},{default:e(()=>[p("mdi-delete")]),_:1})]),_:2},1032,["onClick"])])]))),128))])]),_:1})]),_:1}),a(d,{cols:"12"},{default:e(()=>[n("input",{type:"file",hidden:"",id:"file-input",onChange:Q},null,32),a(f,{variant:"flat",onClick:J,color:"primary",block:"",height:"45"},{default:e(()=>[p(" Fayl qo'shish ")]),_:1})]),_:1})],64)),a(d,{cols:"12",class:"pt-0"},{default:e(()=>[a(f,{variant:"flat",color:"primary",block:"",onClick:T,height:"45"},{default:e(()=>[p(" Saqlash ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{Ce as default};
