import{u as re,r as i,l as ce,m as E,a as n,o as h,c as k,w as e,b as a,f as p,d,t as m,h as L,i as P,F as Q,e as me,j as ve,p as A}from"./index-6f11c559.js";import{a as y}from"./index-7376b9a9.js";const _e={class:"responsive-datatable"},pe={"data-label":"T/r"},fe={"data-label":"Resurs nomi"},be={"data-label":"Fan nomi"},he={"data-label":"Guruh"},ye={"data-label":"O'qituvchi"},xe={"data-label":"Boshqarish"},ge={class:"d-flex justify-end"},ke=d("div",null,"Hech narsa topilmadi",-1),we=["colspan"],Ve={class:"text-h5"},Ue={__name:"Resources",setup(je){const J=[{title:"T/r",align:"start",key:"no",sortable:!1},{title:"Resurs nomi",key:"name"},{title:"Fan nomi",key:"subject"},{title:"Guruhi",key:"group"},{title:"O'qituvchi",key:"teacher"},{title:"Boshqarish",key:"actions",sortable:!1}],w=[t=>!!t||"Required"],K=re(),V=i(""),g=i(null),v=i([]),q=i([]),z=i([]),R=i([]),f=i(!1),x=i(!1),r=i(-1),b=i(-1),s=i({name:null,group:null,subject:null}),j=i([]),F={name:null,group:null,subject:null},M=ce(()=>r.value===-1?"Resurs Yaratish":"Resursni O'zgartirish");E(f,t=>t||I()),E(x,t=>t||C());const W=async()=>{const t=await Promise.all([y.get("/science/"),y.get("/group"),y.get("/resource")]);q.value=t[0].data,z.value=t[1].data,v.value=t[2].data},X=async()=>{const{valid:t}=await g.value.validate();t&&te()},Z=t=>{r.value=v.value.indexOf(t),b.value=t._id,s.value=Object.assign({},t),f.value=!0},ee=t=>{r.value=v.value.indexOf(t),s.value=Object.assign({},t),b.value=t._id,x.value=!0},ae=async()=>{const{data:t}=await y.delete(`/resource/${b.value}`);t&&(v.value.splice(r.value,1),C())},I=()=>{f.value=!1,A(()=>{var t;s.value=Object.assign({},F),b.value=-1,r.value=-1,(t=g.value)==null||t.reset()})},C=()=>{x.value=!1,A(()=>{var t;s.value=Object.assign({},F),b.value=-1,r.value=-1,(t=g.value)==null||t.reset()})},te=async()=>{const t=new FormData;if(t.append("name",s.value.name),t.append("group",s.value.group),t.append("subject",s.value.subject),t.append("teacher",K.getters.userid),j.value.map(o=>t.append("files",o)),r.value>-1){const{data:o}=await y.put(`/science/${b.value}`,s.value);Object.assign(v.value[r.value],o)}else{const{data:o}=await y.post("/resource",t);v.value.push(o)}I()};return W(),(t,o)=>{const B=n("v-text-field"),c=n("v-col"),_=n("v-btn"),O=n("v-row"),T=n("v-sheet"),U=n("v-spacer"),$=n("v-chip"),le=n("v-list-item"),oe=n("v-list"),ne=n("v-data-table"),D=n("v-card-title"),N=n("v-select"),se=n("v-file-input"),ue=n("v-form"),G=n("v-container"),ie=n("v-card-text"),S=n("v-card"),H=n("v-dialog"),de=n("v-card-actions");return h(),k(G,{fluid:""},{default:e(()=>[a(O,null,{default:e(()=>[a(c,{cols:"12"},{default:e(()=>[a(T,{elevation:"1",color:"surface",width:"100%",class:"pa-2",rounded:""},{default:e(()=>[a(O,{justify:"space-between"},{default:e(()=>[a(c,{cols:"12",sm:"4"},{default:e(()=>[a(B,{label:"Qidirish",modelValue:V.value,"onUpdate:modelValue":o[0]||(o[0]=l=>V.value=l),variant:"outlined",color:"primary",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),a(c,{cols:"12",sm:"4",md:"3"},{default:e(()=>[a(_,{block:"",color:"primary",onClick:o[1]||(o[1]=l=>f.value=!0),variant:"tonal"},{default:e(()=>[p("Resurs yaratish")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(c,{cols:"12"},{default:e(()=>[a(T,{elevation:"1",color:"surface",width:"100%",class:"pa-2",rounded:""},{default:e(()=>[d("div",_e,[a(ne,{headers:J,search:V.value,items:v.value,expanded:R.value,"onUpdate:expanded":o[2]||(o[2]=l=>R.value=l),"show-expand":""},{"item.no":e(({index:l})=>[d("td",pe,m(l+1)+".",1)]),"item.name":e(({item:l})=>[d("td",fe,m(l.raw.name),1)]),"item.subject":e(({item:l})=>[d("td",be,m(l.raw.subject),1)]),"item.group":e(({item:l})=>{var u;return[d("td",he,m((u=l.raw.group)==null?void 0:u.name),1)]}),"item.teacher":e(({item:l})=>{var u;return[d("td",ye,m((u=l.raw.teacher)==null?void 0:u.name),1)]}),"item.actions":e(({item:l})=>[d("td",xe,[a(U),d("div",ge,[a(_,{variant:"text",size:"40",color:"primary",icon:"mdi-file-plus"}),a(_,{icon:"mdi-pencil",variant:"text",size:"40",color:"primary",onClick:u=>Z(l.raw)},null,8,["onClick"]),a(_,{icon:"mdi-delete",variant:"text",size:"40",color:"primary",onClick:u=>ee(l.raw)},null,8,["onClick"])])])]),"no-data":e(()=>[ke]),"expanded-row":e(({columns:l,item:u})=>[d("tr",null,[d("td",{colspan:l.length},[a(oe,{nav:"",density:"compact"},{default:e(()=>[(h(!0),L(Q,null,P(u.raw.files,Y=>(h(),k(le,{key:Y},{default:e(()=>[a($,{color:"primary",label:"",closable:""},{default:e(()=>[p(m(Y),1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)],8,we)])]),_:1},8,["search","items","expanded"])])]),_:1})]),_:1})]),_:1}),a(H,{modelValue:f.value,"onUpdate:modelValue":o[7]||(o[7]=l=>f.value=l),"max-width":"550px"},{default:e(()=>[a(S,null,{default:e(()=>[a(D,{class:"mt-2 ml-2 mb-0"},{default:e(()=>[d("span",Ve,m(me(M)),1)]),_:1}),a(ie,{class:"px-2 pt-0"},{default:e(()=>[a(G,null,{default:e(()=>[a(ue,{ref_key:"form",ref:g},{default:e(()=>[a(O,null,{default:e(()=>[a(c,{cols:"12"},{default:e(()=>[a(B,{modelValue:s.value.name,"onUpdate:modelValue":o[3]||(o[3]=l=>s.value.name=l),label:"Resurs Nomi","hide-details":"",color:"primary",rules:w,variant:"outlined"},null,8,["modelValue"])]),_:1}),a(c,{cols:"12"},{default:e(()=>[a(N,{modelValue:s.value.group,"onUpdate:modelValue":o[4]||(o[4]=l=>s.value.group=l),label:"Guruh",rules:w,"hide-details":"",items:z.value,color:"primary","item-title":"name","item-value":"_id",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),a(c,{cols:"12"},{default:e(()=>[a(N,{modelValue:s.value.subject,"onUpdate:modelValue":o[5]||(o[5]=l=>s.value.subject=l),label:"Fan nomi",rules:w,"hide-details":"",items:q.value,color:"primary","item-title":"name","item-value":"name",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),r.value===-1?(h(),k(c,{key:0,cols:"12"},{default:e(()=>[a(se,{variant:"outlined",color:"primary",modelValue:j.value,"onUpdate:modelValue":o[6]||(o[6]=l=>j.value=l),"prepend-icon":null,label:"Fayllar",multiple:"","show-size":!0},{selection:e(({fileNames:l})=>[(h(!0),L(Q,null,P(l,u=>(h(),k($,{key:u,size:"small",label:"",color:"primary",class:"me-2"},{default:e(()=>[p(m(u),1)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})):ve("",!0),a(c,{cols:"12"},{default:e(()=>[a(_,{variant:"tonal",color:"primary",block:"",onClick:X,height:"45"},{default:e(()=>[p(" Saqlash ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(H,{modelValue:x.value,"onUpdate:modelValue":o[8]||(o[8]=l=>x.value=l),"max-width":"500px"},{default:e(()=>[a(S,null,{default:e(()=>[a(D,{class:"text-h6"},{default:e(()=>[p(" Ushbu ma'lumotni ochirmoqchimisiz? ")]),_:1}),a(de,null,{default:e(()=>[a(U),a(_,{color:"blue-darken-1",variant:"text",onClick:C},{default:e(()=>[p(" Yo'q ")]),_:1}),a(_,{color:"blue-darken-1",variant:"text",onClick:ae},{default:e(()=>[p(" Ha ")]),_:1}),a(U)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{Ue as default};
